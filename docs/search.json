[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "LSHTM - ASME",
    "section": "",
    "text": "This site contains the solutions in R for Advanced Statistical Methods in Epidemiology (2412)"
  },
  {
    "objectID": "ASME_09.html",
    "href": "ASME_09.html",
    "title": "09: Further issues in analysis of cohort studies",
    "section": "",
    "text": "Show the code\nlibrary(haven) \n# create table\nlibrary(gtsummary)\n# data wrangling and other functions\nlibrary(tidyverse)\n# if you want to have a output similar to stata\nlibrary(tidylog)\n#cox\nlibrary(survival)\n# plots survival\nlibrary(ggsurvfit)\n# Limit significant digits to 2, remove scientific notation\noptions(digits = 2, scipen = 9)\n\ndiet &lt;- read_dta(\"datasets/DIETLSH.dta\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n\ndiet &lt;- diet |&gt; \n  mutate(hieng = factor(hieng,\n                                levels = c(0, 1),\n                                labels = c(\"normal\", \"high-energy\")),\n                 fibre_cat = cut_number(fibre, 3))\n\n\n\nQ1\nUse the data in dietlsh.dta to estimate the effect of hieng on chd when the time scale is set equal to time since entry using stcox.\n\n\nShow the code\n# Create Cox model\ncox_mod &lt;- coxph(Surv(time = fup, event=chd) ~ hieng, data = diet)\n\n# Calculating 95% CIs for HRs\ntbl_regression(cox_mod, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nhieng\n\n\n\n\n\n\n\n\n\n\n\n\n    normal\n155\n28\n—\n—\n\n\n\n\n    high-energy\n182\n18\n0.52\n0.29, 0.95\n0.032\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\nQ2\nExamine the proportionality assumption using a Nelson-Aalen plot. Does the proportionality assumption appear to be valid?\n\n\nShow the code\nsurvfit2(Surv(time = fup, event=chd) ~ hieng, data = diet) |&gt; \n  ggsurvfit(\n    type = \"cumhaz\"\n  )+\n  scale_y_log10()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nOn this time scale the effect of hieng appears to be proportional as the two lines are quite parallel.\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nNelson-Aalen plot is the plot in the cumulative hazard. The ggsurvfit function accept multiple statistics: “survival” (KM plot), “risk” (Cumulative incidence), “cumhaz” (NA plot), “cloglog” (complimentary log-log survival). It is necessary to transform the Y axis to the log scale. (The PH assumption is in log)\n\n\n\n\n\nQ3\nDoes an interaction test confirm your conclusions?\n\n\nShow the code\ncox.zph(coxph(Surv(time = fup, event=chd) ~ hieng, data = diet))\n\n\n       chisq df    p\nhieng  0.881  1 0.35\nGLOBAL 0.881  1 0.35\n\n\nShow the code\nplot(cox.zph(coxph(Surv(time = fup, event=chd) ~ hieng, data = diet)))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThere is little evidence that the effect of hieng is not proportional using time in the study.\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nThe answer in STATA praticals is using stsplit-spliting the dataset by time since fup- and doing a interaction. In R, we have cox.zph which fits a model with interaction between time and each covariate in the model. And it is possible to visualize the time-varying coefficient\n\n\n\n\n\nQ4/Q5\nRe-examine Question 1 and Question 2 using attained age as the time-scale. Is the proportionality assumption valid? What are the problems with assessing proportionality using graphical methods when using age as the time-scale?\nAssess the proportionality assumption by including an interaction between time period and hieng.\n\n\nShow the code\ncox_mod &lt;- coxph(Surv(time = as.numeric(doe), \n                      time2 = as.numeric(dox),\n                      origin = as.numeric(dob),\n                      event=chd) ~ hieng, data = diet)\ntbl_regression(cox_mod, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nhieng\n\n\n\n\n\n\n\n\n\n\n\n\n    normal\n155\n28\n—\n—\n\n\n\n\n    high-energy\n182\n18\n0.54\n0.30, 0.98\n0.043\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\nNA plots\n\n\nShow the code\nsurvfit2(Surv(time = as.numeric(doe)/365.25, \n                      time2 = as.numeric(dox)/365.25,\n                      origin = as.numeric(dob)/365.25,\n                      event=chd) ~ hieng, data = diet) |&gt; \n  ggsurvfit(\n    type = \"cumhaz\"\n  )+\n  scale_y_log10()\n\n\n\n\n\n\n\n\n\nInteraction plots\n\n\nShow the code\ncox.zph(cox_mod)\n\n\n       chisq df   p\nhieng  0.698  1 0.4\nGLOBAL 0.698  1 0.4\n\n\nShow the code\nplot(cox.zph(cox_mod))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe estimated effect of hieng has not really changed but the effect does not appear to be proportional on this scale. However, in using attained age as the time-scale there are few individuals at the beginning of follow-up (the median age for entry into the study was 48.8 years). Therefore when early events occur they are based on few individuals and so the hazard estimates are less reliable here which impacts on the cumulative event rates over the course of follow-up. For this reason Nelson-Aalen plots are most useful when there is no delayed entry e.g. when the time-scale is time since entry into the study.\n\n\n\n\n\nQ6\nCreate a categorical variable (fibcat3) containing the fibre content of the diet in thirds. Examine the effect of fibcat3, first using time since entry and then attained age as time-scale.\n\n\nShow the code\ncox_mod_fup &lt;- coxph(Surv(time = fup, \n                      event=chd) ~ fibre_cat, data = diet)\ntbl_fup &lt;- tbl_regression(cox_mod_fup, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\ncox_mod_age &lt;- coxph(Surv(time = as.numeric(doe), \n                      time2 = as.numeric(dox),\n                      origin = as.numeric(dob),\n                      event=chd) ~ fibre_cat, data = diet)\ntbl_age &lt;- tbl_regression(cox_mod_age, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\ntbl_merge(list(\n  tbl_fup,\n  tbl_age\n  ),\n         tab_spanner = c(\"**Time since entry**\", \"**Age**\") )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nTime since entry\n\n\nAge\n\n\n\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nfibre_cat\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    [0.605,1.45]\n112\n21\n—\n—\n\n\n112\n21\n—\n—\n\n\n\n\n    (1.45,1.83]\n110\n17\n0.82\n0.43, 1.56\n0.6\n110\n17\n0.79\n0.42, 1.50\n0.5\n\n\n    (1.83,5.35]\n111\n7\n0.29\n0.12, 0.68\n0.005\n111\n7\n0.29\n0.12, 0.69\n0.005\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\nAssess proportionality\nTime since entry\n\n\nShow the code\ncox.zph(cox_mod_fup)\n\n\n          chisq df    p\nfibre_cat 0.251  2 0.88\nGLOBAL    0.251  2 0.88\n\n\nShow the code\nplot(cox.zph(cox_mod_fup))\n\n\n\n\n\n\n\n\n\nAge\n\n\nShow the code\ncox.zph(cox_mod_fup)\n\n\n          chisq df    p\nfibre_cat 0.251  2 0.88\nGLOBAL    0.251  2 0.88\n\n\nShow the code\nplot(cox.zph(cox_mod_fup))\n\n\n\n\n\n\n\n\n\n\n\nQ7\nUse the PBC data set: pbc1bas.dta. Set the time and failure variables as in ASME 7, section 3 (i.e. with time in the study as the time scale) and then examine separately the effects of treatment, bilirubin and cirrhosis. What assumptions are you making? Fit a multivariate model with these three variables. What happens to the estimated rate ratios? Is this the most appropriate time scale to use?\n\n\nShow the code\npbc &lt;- read_dta(\"datasets/PBC1BAS.DTA\")\n\n# Data management\npbc&lt;- pbc |&gt; mutate(death = d,\n               treat = factor(treat, levels = c(1, 2), labels = c(\"placebo\", \"azath\")),\n               cenc0 = factor(cenc0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               cir0 = factor(cir0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               gh0 = factor(gh0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               asc0 = factor(asc0, levels = c(0, 1), labels = c(\"no\", \"yes\"))) |&gt; \n         select(-d)\n\n\n\n\nShow the code\nmod_tto &lt;- coxph(Surv(time,death) ~ treat, data = pbc)\nmod_tto1 &lt;- coxph(Surv(time,death) ~ treat+logb0, data = pbc)\nmod_tto2 &lt;- coxph(Surv(time,death) ~ treat+logb0+cir0, data = pbc)\n\ntbl_tto &lt;- tbl_regression(mod_tto, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_tto1 &lt;- tbl_regression(mod_tto1, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_tto2 &lt;- tbl_regression(mod_tto2, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_merge(list(tbl_tto,tbl_tto1,tbl_tto2),\n          tab_spanner = c(\"**Treat**\", \"**Treat+bili**\",\"**Treat+bili+cirr**\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nTreat\n\n\nTreat+bili\n\n\nTreat+bili+cirr\n\n\n\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\ntreat\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    placebo\n90\n49\n—\n—\n\n\n90\n49\n—\n—\n\n\n90\n49\n—\n—\n\n\n\n\n    azath\n94\n47\n0.86\n0.57, 1.28\n0.5\n94\n47\n0.65\n0.43, 0.99\n0.044\n94\n47\n0.63\n0.42, 0.96\n0.031\n\n\nLob Bilirubin at entry\n\n\n\n\n\n\n\n\n\n\n184\n96\n10.6\n6.42, 17.6\n&lt;0.001\n184\n96\n11.4\n6.68, 19.6\n&lt;0.001\n\n\ncir0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    no\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n131\n58\n—\n—\n\n\n\n\n    yes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n53\n38\n2.50\n1.64, 3.82\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nWe find that there is little evidence for an effect of treatment (HR=0.86 (95% CI 0.57 to 1.28), p=0.45). The assumption is that this effect is constant over the follow-up time period.\nAdjusting for a prognostic factor (bilirubin) which was not evenly distributed between the two treatment arms at baseline we obtain, a treatment HR=0.65 (95% CI 0.43 to 0.99). Further adjustment for presence of cirrhosis at entry into the trial has little effect on the estimated effect of treatment HR= 0.63 (0.42 to 0.96)\nThe underlying assumption is that treatment reduces mortality by about 37% over the entire follow-up period, once the effects of bilirubin and cirrhosis at entry into the trial are taken into account. Time in study (i.e. time since randomisation) would be the appropriate time scale to use as these are data from a randomised controlled trial.",
    "crumbs": [
      "Home",
      "09: Further issues in analysis of cohort studies"
    ]
  },
  {
    "objectID": "ASME_07.html",
    "href": "ASME_07.html",
    "title": "07: Poisson regression for cohort studies",
    "section": "",
    "text": "Show the code\n# read \"dta\" files\nlibrary(haven) \n# create table\nlibrary(gtsummary)\n# data wrangling and other functions\nlibrary(tidyverse)\n# if you want to have a output similar to stata\nlibrary(tidylog)\n#cox\nlibrary(survival)\n# plots survival\nlibrary(ggsurvfit)\n# Limit significant digits to 2, remove scientific notation\noptions(digits = 2, scipen = 9)\n\n\nThe following questions refer to the dataset ondrate.dta. This contains data on 1536 individuals living in an onchocercal zone in Nigeria, who were followed over a period up to 3 years to study the incidence of optic nerve disease (OND) and the extent to which onchocerciasis is a risk factor for OND.\n\nQ1\nUse the desc-STATA / glimpse() and list(STATA) / str() commands to find out what information the dataset contains.\n\n\nShow the code\nondrate &lt;- read_stata(\"datasets/ondrate.dta\")\n\nglimpse(ondrate)\n\n\nRows: 1,536\nColumns: 8\n$ id      &lt;dbl&gt; 18, 23, 30, 39, 42, 43, 48, 56, 62, 63, 72, 73, 75, 78, 79, 90…\n$ disc2   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,…\n$ age     &lt;dbl+lbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1, 1, 1, 1…\n$ sex     &lt;dbl&gt; 1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 2, 2, 2, 1, 1, 2, 1,…\n$ mfpermg &lt;dbl+lbl&gt; 2, 0, 2, 2, 1, 0, 1, 0, 2, 1, 2, 2, 2, 1, 2, 1, 2, 0, 0, 0…\n$ pyrs    &lt;dbl&gt; 2.7, 1.9, 2.7, 2.7, 2.7, 2.8, 2.7, 2.7, 2.7, 1.9, 2.7, 2.7, 2.…\n$ start   &lt;date&gt; 1983-01-01, 1983-01-01, 1983-01-01, 1983-01-01, 1983-01-01, 1…\n$ end     &lt;date&gt; 1985-09-27, 1984-11-28, 1985-09-27, 1985-09-27, 1985-09-27, 1…\n\n\nShow the code\nondrate &lt;- read_stata(\"datasets/ondrate.dta\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n# alternative\n#str(ondrate)\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nAge is coded as numeric, but it is a categorical variable in the original dataset. We can convert all variables with labels (STATA) to factor. The code mutate(across(where(is.labelled),as_factor)) checks if a column has labels, if it has, convert to factor\n\n\n\n\n\nQ2\nUse the strate(STATA)/ pyears() command to examine the patterns of incidence of OND by age, sex and microfilarial load (a measure of the intensity of onchocercal infection). Don’t forget that you will need to issue the following command before you can use any st commands:\n\nShow the code\n# Rates by age\n# The default value of scale in\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ age, ondrate, scale = 365.25) %&gt;% summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ age, data = ondrate, scale = 365.25)\nnumber of observations = 1536\n\n\n\nage\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n&lt;35\n19\n2352\n8.1\n4.9 - 13\n\n\n35-44\n16\n812\n19.7\n11.3 - 32\n\n\n45-54\n20\n453\n44.2\n27.0 - 68\n\n\n55+\n16\n285\n56.1\n32.0 - 91\n\n\n\n\nShow the code\n# Rates by sex\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ sex, ondrate)  |&gt;  summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ sex, data = ondrate)\nnumber of observations = 1536\n\n\n\nsex\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n1\n38\n1858\n20\n14 - 28\n\n\n2\n33\n2044\n16\n11 - 23\n\n\n\n\nShow the code\n# Rates by microfilarial load\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ mfpermg, ondrate)  |&gt;  summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ mfpermg, data = ondrate)\nnumber of observations = 1536\n\n\n\nmfpermg\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n0\n14\n1157\n12\n6.6 - 20\n\n\n1-9.99\n18\n1511\n12\n7.1 - 19\n\n\n10+\n39\n1233\n32\n22.5 - 43\n\n\n\n\n\nQ3\nUsing the streg(STATA) / glm command and the dist(exp)(STATA)/family=poisson option, fit simple Poisson regression models to estimate (separately) the crude effects of age, sex and microfilarial load on OND incidence. Compare the rate ratio estimates obtained from streg (STATA)/glm (Poisson regression) with those obtained using stmh.\n(As explained in Pratical 6 - Q9, it is painfull to do mantel haenszel rate ratio in R and there is no gain in conduct MH instead Poisson regression)\n\n\nShow the code\n# Age\nglm(disc2 ~ age + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Age\")\n\n\n\n\n\n\nAge\n\n\n\n\n\n\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nAge at start\n\n\n\n\n\n\n\n\n    &lt;35\n—\n—\n\n\n\n\n    35-44\n0.89\n0.21, 1.6\n0.009\n\n\n    45-54\n1.7\n1.1, 2.3\n&lt;0.001\n\n\n    55+\n1.9\n1.3, 2.6\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\nShow the code\n# Sex\nglm(disc2 ~ sex + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Sex\")\n\n\n\n\n\n\nSex\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nSex: 1=male, 2=female\n-0.24\n-0.71, 0.23\n0.3\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\nShow the code\n# Microfilarial load\nglm(disc2 ~ mfpermg + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Microfilarial load\")\n\n\n\n\n\n\nMicrofilarial load\n\n\n\n\n\n\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nMicrofilariae per mg\n\n\n\n\n\n\n\n\n    0\n—\n—\n\n\n\n\n    1-9.99\n-0.02\n-0.71, 0.70\n&gt;0.9\n\n\n    10+\n0.96\n0.37, 1.6\n0.002\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\n\n\nQ4\nAre either age or sex associated with microfilarial load (MfL)? Which, if either, are likely to confound the association between microfilarial load and incidence of OND?\n\n\nShow the code\nondrate |&gt; \n  tbl_summary(by = mfpermg,\n              include = c(age,sex)) |&gt; \n  add_p()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n0 N = 4711\n1-9.99 N = 5881\n10+ N = 4771\np-value2\n\n\n\n\nAge at start\n\n\n\n\n\n\n0.019\n\n\n    &lt;35\n315 (67%)\n342 (58%)\n268 (56%)\n\n\n\n\n    35-44\n78 (17%)\n136 (23%)\n106 (22%)\n\n\n\n\n    45-54\n48 (10%)\n70 (12%)\n60 (13%)\n\n\n\n\n    55+\n30 (6.4%)\n40 (6.8%)\n43 (9.0%)\n\n\n\n\nSex: 1=male, 2=female\n\n\n\n\n\n\n0.12\n\n\n    1\n211 (45%)\n278 (47%)\n245 (51%)\n\n\n\n\n    2\n260 (55%)\n310 (53%)\n232 (49%)\n\n\n\n\n\n1 n (%)\n\n\n2 Pearson’s Chi-squared test\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nMfL of males and females is similar. Age is potential confounder, sex is unlikely to be\n\n\n\n\n\nQ5\nUse Poisson regression to obtain rate ratio estimates for microfilarial load adjusted for (i) age, (ii) sex, (iii) both age and sex. Is there any indication of confounding?\n\n\nShow the code\n# Age\ntbl_age &lt;- glm(disc2 ~ mfpermg + age + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n# Sex\ntbl_sex &lt;- glm(disc2 ~ mfpermg+ sex + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n# Microfilarial load\ntbl_both &lt;- glm(disc2 ~ mfpermg +sex+age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n\ntbl_merge(list(\n  tbl_age,\n  tbl_sex,\n  tbl_both\n  ),\n         tab_spanner = c(\"**Adjusted for Age**\", \"**Sex**\",\n                         \"**Both**\") )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nAdjusted for Age\n\n\nSex\n\n\nBoth\n\n\n\nlog(IRR)\n95% CI\np-value\nlog(IRR)\n95% CI\np-value\nlog(IRR)\n95% CI\np-value\n\n\n\n\nMicrofilariae per mg\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    0\n—\n—\n\n\n—\n—\n\n\n—\n—\n\n\n\n\n    1-9.99\n-0.09\n-0.79, 0.63\n0.8\n-0.02\n-0.71, 0.70\n&gt;0.9\n-0.08\n-0.78, 0.63\n0.8\n\n\n    10+\n0.82\n0.23, 1.5\n0.008\n0.95\n0.36, 1.6\n0.002\n0.82\n0.24, 1.5\n0.008\n\n\nAge at start\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    &lt;35\n—\n—\n\n\n\n\n\n\n\n\n—\n—\n\n\n\n\n    35-44\n0.86\n0.18, 1.5\n0.011\n\n\n\n\n\n\n0.85\n0.17, 1.5\n0.012\n\n\n    45-54\n1.7\n1.0, 2.3\n&lt;0.001\n\n\n\n\n\n\n1.7\n1.0, 2.3\n&lt;0.001\n\n\n    55+\n1.9\n1.2, 2.5\n&lt;0.001\n\n\n\n\n\n\n1.8\n1.2, 2.5\n&lt;0.001\n\n\nSex: 1=male, 2=female\n\n\n\n\n\n\n-0.19\n-0.67, 0.27\n0.4\n-0.13\n-0.60, 0.34\n0.6\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nCompared with the crude rate ratios, the age-adjusted rate ratios for MfL groups 1-9.99 and 10+ are somewhat reduced, indicating some confounding as expected (those with high MfL tend to be older and at greater risk because of their older age).\nAdjusting for sex has little impact on the mf load rate ratios, indicating little or no confounding (again as expected – little difference in mf load between the sexes). Adjusting for sex in addition to age changes the mf load rate ratios only slightly. There is no evidence (Wald test p-value of 0.587) that sex is associated with OND.\n\n\n\n\n\nQ6\nPoisson regression models assume, unless you include interaction terms, that effects of different variables combine multiplicatively. Is there any evidence of an interaction between age and microfilarial load? Between sex and microfilarial load?\nSex\n\n\nShow the code\ntbl_no_int &lt;- glm(disc2 ~ mfpermg +sex+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_w_int &lt;- glm(disc2 ~ mfpermg*sex+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_no_int,tbl_w_int)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ mfpermg + sex + offset(log(pyrs))\nModel 2: disc2 ~ mfpermg * sex + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   4   -276                    \n2   6   -276  2  0.31       0.86\n\n\nAge\n\n\nShow the code\ntbl_no_int &lt;- glm(disc2 ~ mfpermg +age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_w_int &lt;- glm(disc2 ~ mfpermg*age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_no_int,tbl_w_int)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ mfpermg + age + offset(log(pyrs))\nModel 2: disc2 ~ mfpermg * age + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   6   -256                    \n2  12   -251  6  9.13       0.17\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe likelihood ratio test for sex produces p=0.856, so there is no evidence of an interaction between mf load and sex. i.e. there is no evidence that the effect of MfL on OND is different for males and females. Similarly, there is no evidence of an interaction between age and MfL (p=0.17), however it is important to note the number of parameters (6) used in this LRT. You could try testing age as ordinal variable (also no evidence of interaction, p = 0.14)\n\n\n\n\n\nQ7\nFitting the age variable included in the dataset as a factor introduces three parameters into the model. Would it be reasonable to treat the age variable as continuous and thus reduce the number of parameters in the model? How would you assess this?\n\n\nShow the code\ntbl_ordinal &lt;- glm(disc2 ~ as.numeric(age)+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_cat &lt;- glm(disc2 ~ age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_ordinal,tbl_cat)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ as.numeric(age) + offset(log(pyrs))\nModel 2: disc2 ~ age + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   2   -264                    \n2   4   -263  2  2.14       0.34\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe likelihood ratio test shows no evidence against (or in favor) of using age as ordinal (linear)\n\n\n\n\n\nQ8\nOpen whitehal.dta and use Poisson regression to repeat the analyses in question 11 of practical 5, i.e. examine the effect of job grade on CHD mortality adjusted for ageband and smoking status simultaneously. How does the result obtained from Poisson regression compare to that obtained using the stmh command?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nQ11 of Session 6 already has it",
    "crumbs": [
      "Home",
      "07: Poisson regression for cohort studies"
    ]
  }
]