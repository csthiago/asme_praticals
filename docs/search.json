[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "LSHTM - ASME",
    "section": "",
    "text": "This site contains the solutions in R for Advanced Statistical Methods in Epidemiology (2412)"
  },
  {
    "objectID": "ASME_09.html",
    "href": "ASME_09.html",
    "title": "09: Further issues in analysis of cohort studies",
    "section": "",
    "text": "Show the code\nlibrary(haven) \n# create table\nlibrary(gtsummary)\n# data wrangling and other functions\nlibrary(tidyverse)\n# if you want to have a output similar to stata\nlibrary(tidylog)\n#cox\nlibrary(survival)\n# plots survival\nlibrary(ggsurvfit)\n# Limit significant digits to 2, remove scientific notation\noptions(digits = 2, scipen = 9)\n\ndiet &lt;- read_dta(\"datasets/DIETLSH.dta\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n\ndiet &lt;- diet |&gt; \n  mutate(hieng = factor(hieng,\n                                levels = c(0, 1),\n                                labels = c(\"normal\", \"high-energy\")),\n                 fibre_cat = cut_number(fibre, 3))\n\n\n\nQ1\nUse the data in dietlsh.dta to estimate the effect of hieng on chd when the time scale is set equal to time since entry using stcox.\n\n\nShow the code\n# Create Cox model\ncox_mod &lt;- coxph(Surv(time = fup, event=chd) ~ hieng, data = diet)\n\n# Calculating 95% CIs for HRs\ntbl_regression(cox_mod, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nhieng\n\n\n\n\n\n\n\n\n\n\n\n\n    normal\n155\n28\n—\n—\n\n\n\n\n    high-energy\n182\n18\n0.52\n0.29, 0.95\n0.032\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\nQ2\nExamine the proportionality assumption using a Nelson-Aalen plot. Does the proportionality assumption appear to be valid?\n\n\nShow the code\nsurvfit2(Surv(time = fup, event=chd) ~ hieng, data = diet) |&gt; \n  ggsurvfit(\n    type = \"cumhaz\"\n  )+\n  scale_y_log10()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nOn this time scale the effect of hieng appears to be proportional as the two lines are quite parallel.\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nNelson-Aalen plot is the plot in the cumulative hazard. The ggsurvfit function accept multiple statistics: “survival” (KM plot), “risk” (Cumulative incidence), “cumhaz” (NA plot), “cloglog” (complimentary log-log survival). It is necessary to transform the Y axis to the log scale. (The PH assumption is in log)\n\n\n\n\n\nQ3\nDoes an interaction test confirm your conclusions?\n\n\nShow the code\ncox.zph(coxph(Surv(time = fup, event=chd) ~ hieng, data = diet))\n\n\n       chisq df    p\nhieng  0.881  1 0.35\nGLOBAL 0.881  1 0.35\n\n\nShow the code\nplot(cox.zph(coxph(Surv(time = fup, event=chd) ~ hieng, data = diet)))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThere is little evidence that the effect of hieng is not proportional using time in the study.\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nThe answer in STATA praticals is using stsplit-spliting the dataset by time since fup- and doing a interaction. In R, we have cox.zph which fits a model with interaction between time and each covariate in the model. And it is possible to visualize the time-varying coefficient\n\n\n\n\n\nQ4/Q5\nRe-examine Question 1 and Question 2 using attained age as the time-scale. Is the proportionality assumption valid? What are the problems with assessing proportionality using graphical methods when using age as the time-scale?\nAssess the proportionality assumption by including an interaction between time period and hieng.\n\n\nShow the code\ncox_mod &lt;- coxph(Surv(time = as.numeric(doe), \n                      time2 = as.numeric(dox),\n                      origin = as.numeric(dob),\n                      event=chd) ~ hieng, data = diet)\ntbl_regression(cox_mod, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nhieng\n\n\n\n\n\n\n\n\n\n\n\n\n    normal\n155\n28\n—\n—\n\n\n\n\n    high-energy\n182\n18\n0.54\n0.30, 0.98\n0.043\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\nNA plots\n\n\nShow the code\nsurvfit2(Surv(time = as.numeric(doe)/365.25, \n                      time2 = as.numeric(dox)/365.25,\n                      origin = as.numeric(dob)/365.25,\n                      event=chd) ~ hieng, data = diet) |&gt; \n  ggsurvfit(\n    type = \"cumhaz\"\n  )+\n  scale_y_log10()\n\n\n\n\n\n\n\n\n\nInteraction plots\n\n\nShow the code\ncox.zph(cox_mod)\n\n\n       chisq df   p\nhieng  0.698  1 0.4\nGLOBAL 0.698  1 0.4\n\n\nShow the code\nplot(cox.zph(cox_mod))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe estimated effect of hieng has not really changed but the effect does not appear to be proportional on this scale. However, in using attained age as the time-scale there are few individuals at the beginning of follow-up (the median age for entry into the study was 48.8 years). Therefore when early events occur they are based on few individuals and so the hazard estimates are less reliable here which impacts on the cumulative event rates over the course of follow-up. For this reason Nelson-Aalen plots are most useful when there is no delayed entry e.g. when the time-scale is time since entry into the study.\n\n\n\n\n\nQ6\nCreate a categorical variable (fibcat3) containing the fibre content of the diet in thirds. Examine the effect of fibcat3, first using time since entry and then attained age as time-scale.\n\n\nShow the code\ncox_mod_fup &lt;- coxph(Surv(time = fup, \n                      event=chd) ~ fibre_cat, data = diet)\ntbl_fup &lt;- tbl_regression(cox_mod_fup, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\ncox_mod_age &lt;- coxph(Surv(time = as.numeric(doe), \n                      time2 = as.numeric(dox),\n                      origin = as.numeric(dob),\n                      event=chd) ~ fibre_cat, data = diet)\ntbl_age &lt;- tbl_regression(cox_mod_age, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\n\ntbl_merge(list(\n  tbl_fup,\n  tbl_age\n  ),\n         tab_spanner = c(\"**Time since entry**\", \"**Age**\") )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nTime since entry\n\n\nAge\n\n\n\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\nfibre_cat\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    [0.605,1.45]\n112\n21\n—\n—\n\n\n112\n21\n—\n—\n\n\n\n\n    (1.45,1.83]\n110\n17\n0.82\n0.43, 1.56\n0.6\n110\n17\n0.79\n0.42, 1.50\n0.5\n\n\n    (1.83,5.35]\n111\n7\n0.29\n0.12, 0.68\n0.005\n111\n7\n0.29\n0.12, 0.69\n0.005\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\nAssess proportionality\nTime since entry\n\n\nShow the code\ncox.zph(cox_mod_fup)\n\n\n          chisq df    p\nfibre_cat 0.251  2 0.88\nGLOBAL    0.251  2 0.88\n\n\nShow the code\nplot(cox.zph(cox_mod_fup))\n\n\n\n\n\n\n\n\n\nAge\n\n\nShow the code\ncox.zph(cox_mod_fup)\n\n\n          chisq df    p\nfibre_cat 0.251  2 0.88\nGLOBAL    0.251  2 0.88\n\n\nShow the code\nplot(cox.zph(cox_mod_fup))\n\n\n\n\n\n\n\n\n\n\n\nQ7\nUse the PBC data set: pbc1bas.dta. Set the time and failure variables as in ASME 7, section 3 (i.e. with time in the study as the time scale) and then examine separately the effects of treatment, bilirubin and cirrhosis. What assumptions are you making? Fit a multivariate model with these three variables. What happens to the estimated rate ratios? Is this the most appropriate time scale to use?\n\n\nShow the code\npbc &lt;- read_dta(\"datasets/PBC1BAS.DTA\")\n\n# Data management\npbc&lt;- pbc |&gt; mutate(death = d,\n               treat = factor(treat, levels = c(1, 2), labels = c(\"placebo\", \"azath\")),\n               cenc0 = factor(cenc0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               cir0 = factor(cir0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               gh0 = factor(gh0, levels = c(0, 1), labels = c(\"no\", \"yes\")),\n               asc0 = factor(asc0, levels = c(0, 1), labels = c(\"no\", \"yes\"))) |&gt; \n         select(-d)\n\n\n\n\nShow the code\nmod_tto &lt;- coxph(Surv(time,death) ~ treat, data = pbc)\nmod_tto1 &lt;- coxph(Surv(time,death) ~ treat+logb0, data = pbc)\nmod_tto2 &lt;- coxph(Surv(time,death) ~ treat+logb0+cir0, data = pbc)\n\ntbl_tto &lt;- tbl_regression(mod_tto, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_tto1 &lt;- tbl_regression(mod_tto1, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_tto2 &lt;- tbl_regression(mod_tto2, exponentiate = T) |&gt; \n  add_n(location=\"level\") |&gt; \n  add_nevent(location=\"level\")\ntbl_merge(list(tbl_tto,tbl_tto1,tbl_tto2),\n          tab_spanner = c(\"**Treat**\", \"**Treat+bili**\",\"**Treat+bili+cirr**\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nTreat\n\n\nTreat+bili\n\n\nTreat+bili+cirr\n\n\n\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\nN\nEvent N\nHR\n95% CI\np-value\n\n\n\n\ntreat\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    placebo\n90\n49\n—\n—\n\n\n90\n49\n—\n—\n\n\n90\n49\n—\n—\n\n\n\n\n    azath\n94\n47\n0.86\n0.57, 1.28\n0.5\n94\n47\n0.65\n0.43, 0.99\n0.044\n94\n47\n0.63\n0.42, 0.96\n0.031\n\n\nLob Bilirubin at entry\n\n\n\n\n\n\n\n\n\n\n184\n96\n10.6\n6.42, 17.6\n&lt;0.001\n184\n96\n11.4\n6.68, 19.6\n&lt;0.001\n\n\ncir0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    no\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n131\n58\n—\n—\n\n\n\n\n    yes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n53\n38\n2.50\n1.64, 3.82\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nWe find that there is little evidence for an effect of treatment (HR=0.86 (95% CI 0.57 to 1.28), p=0.45). The assumption is that this effect is constant over the follow-up time period.\nAdjusting for a prognostic factor (bilirubin) which was not evenly distributed between the two treatment arms at baseline we obtain, a treatment HR=0.65 (95% CI 0.43 to 0.99). Further adjustment for presence of cirrhosis at entry into the trial has little effect on the estimated effect of treatment HR= 0.63 (0.42 to 0.96)\nThe underlying assumption is that treatment reduces mortality by about 37% over the entire follow-up period, once the effects of bilirubin and cirrhosis at entry into the trial are taken into account. Time in study (i.e. time since randomisation) would be the appropriate time scale to use as these are data from a randomised controlled trial.",
    "crumbs": [
      "Home",
      "09: Further issues in analysis of cohort studies"
    ]
  },
  {
    "objectID": "ASME_07.html",
    "href": "ASME_07.html",
    "title": "07: Poisson regression for cohort studies",
    "section": "",
    "text": "Show the code\n# read \"dta\" files\nlibrary(haven) \n# create table\nlibrary(gtsummary)\n# data wrangling and other functions\nlibrary(tidyverse)\n# if you want to have a output similar to stata\nlibrary(tidylog)\n#cox\nlibrary(survival)\n# plots survival\nlibrary(ggsurvfit)\n# Limit significant digits to 2, remove scientific notation\noptions(digits = 2, scipen = 9)\n\n\nThe following questions refer to the dataset ondrate.dta. This contains data on 1536 individuals living in an onchocercal zone in Nigeria, who were followed over a period up to 3 years to study the incidence of optic nerve disease (OND) and the extent to which onchocerciasis is a risk factor for OND.\n\nQ1\nUse the desc-STATA / glimpse() and list(STATA) / str() commands to find out what information the dataset contains.\n\n\nShow the code\nondrate &lt;- read_stata(\"datasets/ondrate.dta\")\n\nglimpse(ondrate)\n\n\nRows: 1,536\nColumns: 8\n$ id      &lt;dbl&gt; 18, 23, 30, 39, 42, 43, 48, 56, 62, 63, 72, 73, 75, 78, 79, 90…\n$ disc2   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0,…\n$ age     &lt;dbl+lbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1, 1, 1, 1…\n$ sex     &lt;dbl&gt; 1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 2, 2, 2, 1, 1, 2, 1,…\n$ mfpermg &lt;dbl+lbl&gt; 2, 0, 2, 2, 1, 0, 1, 0, 2, 1, 2, 2, 2, 1, 2, 1, 2, 0, 0, 0…\n$ pyrs    &lt;dbl&gt; 2.7, 1.9, 2.7, 2.7, 2.7, 2.8, 2.7, 2.7, 2.7, 1.9, 2.7, 2.7, 2.…\n$ start   &lt;date&gt; 1983-01-01, 1983-01-01, 1983-01-01, 1983-01-01, 1983-01-01, 1…\n$ end     &lt;date&gt; 1985-09-27, 1984-11-28, 1985-09-27, 1985-09-27, 1985-09-27, 1…\n\n\nShow the code\nondrate &lt;- read_stata(\"datasets/ondrate.dta\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n# alternative\n#str(ondrate)\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nAge is coded as numeric, but it is a categorical variable in the original dataset. We can convert all variables with labels (STATA) to factor. The code mutate(across(where(is.labelled),as_factor)) checks if a column has labels, if it has, convert to factor\n\n\n\n\n\nQ2\nUse the strate(STATA)/ pyears() command to examine the patterns of incidence of OND by age, sex and microfilarial load (a measure of the intensity of onchocercal infection). Don’t forget that you will need to issue the following command before you can use any st commands:\n\nShow the code\n# Rates by age\n# The default value of scale in\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ age, ondrate, scale = 365.25) %&gt;% summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ age, data = ondrate, scale = 365.25)\nnumber of observations = 1536\n\n\n\nage\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n&lt;35\n19\n2352\n8.1\n4.9 - 13\n\n\n35-44\n16\n812\n19.7\n11.3 - 32\n\n\n45-54\n20\n453\n44.2\n27.0 - 68\n\n\n55+\n16\n285\n56.1\n32.0 - 91\n\n\n\n\nShow the code\n# Rates by sex\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ sex, ondrate)  |&gt;  summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ sex, data = ondrate)\nnumber of observations = 1536\n\n\n\nsex\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n1\n38\n1858\n20\n14 - 28\n\n\n2\n33\n2044\n16\n11 - 23\n\n\n\n\nShow the code\n# Rates by microfilarial load\npyears(Surv(time = as.numeric(start), \n                         time2 = as.numeric(end), \n                         event = disc2) ~ mfpermg, ondrate)  |&gt;  summary(n = F, rate = T, ci.r = T, scale = 1000)\n\nCall: pyears(formula = Surv(time = as.numeric(start), time2 = as.numeric(end), event = disc2) ~ mfpermg, data = ondrate)\nnumber of observations = 1536\n\n\n\nmfpermg\nEvents\nTime\nEvent rate\nCI (rate)\n\n\n\n\n0\n14\n1157\n12\n6.6 - 20\n\n\n1-9.99\n18\n1511\n12\n7.1 - 19\n\n\n10+\n39\n1233\n32\n22.5 - 43\n\n\n\n\n\nQ3\nUsing the streg(STATA) / glm command and the dist(exp)(STATA)/family=poisson option, fit simple Poisson regression models to estimate (separately) the crude effects of age, sex and microfilarial load on OND incidence. Compare the rate ratio estimates obtained from streg (STATA)/glm (Poisson regression) with those obtained using stmh.\n(As explained in Pratical 6 - Q9, it is painfull to do mantel haenszel rate ratio in R and there is no gain in conduct MH instead Poisson regression)\n\n\nShow the code\n# Age\nglm(disc2 ~ age + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Age\")\n\n\n\n\n\n\nAge\n\n\n\n\n\n\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nAge at start\n\n\n\n\n\n\n\n\n    &lt;35\n—\n—\n\n\n\n\n    35-44\n0.89\n0.21, 1.6\n0.009\n\n\n    45-54\n1.7\n1.1, 2.3\n&lt;0.001\n\n\n    55+\n1.9\n1.3, 2.6\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\nShow the code\n# Sex\nglm(disc2 ~ sex + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Sex\")\n\n\n\n\n\n\nSex\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nSex: 1=male, 2=female\n-0.24\n-0.71, 0.23\n0.3\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\nShow the code\n# Microfilarial load\nglm(disc2 ~ mfpermg + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() |&gt; \n  modify_caption(caption = \"Microfilarial load\")\n\n\n\n\n\n\nMicrofilarial load\n\n\n\n\n\n\n\n\nCharacteristic\nlog(IRR)\n95% CI\np-value\n\n\n\n\nMicrofilariae per mg\n\n\n\n\n\n\n\n\n    0\n—\n—\n\n\n\n\n    1-9.99\n-0.02\n-0.71, 0.70\n&gt;0.9\n\n\n    10+\n0.96\n0.37, 1.6\n0.002\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\n\n\nQ4\nAre either age or sex associated with microfilarial load (MfL)? Which, if either, are likely to confound the association between microfilarial load and incidence of OND?\n\n\nShow the code\nondrate |&gt; \n  tbl_summary(by = mfpermg,\n              include = c(age,sex)) |&gt; \n  add_p()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n0 N = 4711\n1-9.99 N = 5881\n10+ N = 4771\np-value2\n\n\n\n\nAge at start\n\n\n\n\n\n\n0.019\n\n\n    &lt;35\n315 (67%)\n342 (58%)\n268 (56%)\n\n\n\n\n    35-44\n78 (17%)\n136 (23%)\n106 (22%)\n\n\n\n\n    45-54\n48 (10%)\n70 (12%)\n60 (13%)\n\n\n\n\n    55+\n30 (6.4%)\n40 (6.8%)\n43 (9.0%)\n\n\n\n\nSex: 1=male, 2=female\n\n\n\n\n\n\n0.12\n\n\n    1\n211 (45%)\n278 (47%)\n245 (51%)\n\n\n\n\n    2\n260 (55%)\n310 (53%)\n232 (49%)\n\n\n\n\n\n1 n (%)\n\n\n2 Pearson’s Chi-squared test\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nMfL of males and females is similar. Age is potential confounder, sex is unlikely to be\n\n\n\n\n\nQ5\nUse Poisson regression to obtain rate ratio estimates for microfilarial load adjusted for (i) age, (ii) sex, (iii) both age and sex. Is there any indication of confounding?\n\n\nShow the code\n# Age\ntbl_age &lt;- glm(disc2 ~ mfpermg + age + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n# Sex\ntbl_sex &lt;- glm(disc2 ~ mfpermg+ sex + offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n# Microfilarial load\ntbl_both &lt;- glm(disc2 ~ mfpermg +sex+age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate)  |&gt; \n  tbl_regression() \n\n\ntbl_merge(list(\n  tbl_age,\n  tbl_sex,\n  tbl_both\n  ),\n         tab_spanner = c(\"**Adjusted for Age**\", \"**Sex**\",\n                         \"**Both**\") )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nAdjusted for Age\n\n\nSex\n\n\nBoth\n\n\n\nlog(IRR)\n95% CI\np-value\nlog(IRR)\n95% CI\np-value\nlog(IRR)\n95% CI\np-value\n\n\n\n\nMicrofilariae per mg\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    0\n—\n—\n\n\n—\n—\n\n\n—\n—\n\n\n\n\n    1-9.99\n-0.09\n-0.79, 0.63\n0.8\n-0.02\n-0.71, 0.70\n&gt;0.9\n-0.08\n-0.78, 0.63\n0.8\n\n\n    10+\n0.82\n0.23, 1.5\n0.008\n0.95\n0.36, 1.6\n0.002\n0.82\n0.24, 1.5\n0.008\n\n\nAge at start\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    &lt;35\n—\n—\n\n\n\n\n\n\n\n\n—\n—\n\n\n\n\n    35-44\n0.86\n0.18, 1.5\n0.011\n\n\n\n\n\n\n0.85\n0.17, 1.5\n0.012\n\n\n    45-54\n1.7\n1.0, 2.3\n&lt;0.001\n\n\n\n\n\n\n1.7\n1.0, 2.3\n&lt;0.001\n\n\n    55+\n1.9\n1.2, 2.5\n&lt;0.001\n\n\n\n\n\n\n1.8\n1.2, 2.5\n&lt;0.001\n\n\nSex: 1=male, 2=female\n\n\n\n\n\n\n-0.19\n-0.67, 0.27\n0.4\n-0.13\n-0.60, 0.34\n0.6\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nCompared with the crude rate ratios, the age-adjusted rate ratios for MfL groups 1-9.99 and 10+ are somewhat reduced, indicating some confounding as expected (those with high MfL tend to be older and at greater risk because of their older age).\nAdjusting for sex has little impact on the mf load rate ratios, indicating little or no confounding (again as expected – little difference in mf load between the sexes). Adjusting for sex in addition to age changes the mf load rate ratios only slightly. There is no evidence (Wald test p-value of 0.587) that sex is associated with OND.\n\n\n\n\n\nQ6\nPoisson regression models assume, unless you include interaction terms, that effects of different variables combine multiplicatively. Is there any evidence of an interaction between age and microfilarial load? Between sex and microfilarial load?\nSex\n\n\nShow the code\ntbl_no_int &lt;- glm(disc2 ~ mfpermg +sex+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_w_int &lt;- glm(disc2 ~ mfpermg*sex+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_no_int,tbl_w_int)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ mfpermg + sex + offset(log(pyrs))\nModel 2: disc2 ~ mfpermg * sex + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   4   -276                    \n2   6   -276  2  0.31       0.86\n\n\nAge\n\n\nShow the code\ntbl_no_int &lt;- glm(disc2 ~ mfpermg +age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_w_int &lt;- glm(disc2 ~ mfpermg*age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_no_int,tbl_w_int)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ mfpermg + age + offset(log(pyrs))\nModel 2: disc2 ~ mfpermg * age + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   6   -256                    \n2  12   -251  6  9.13       0.17\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe likelihood ratio test for sex produces p=0.856, so there is no evidence of an interaction between mf load and sex. i.e. there is no evidence that the effect of MfL on OND is different for males and females. Similarly, there is no evidence of an interaction between age and MfL (p=0.17), however it is important to note the number of parameters (6) used in this LRT. You could try testing age as ordinal variable (also no evidence of interaction, p = 0.14)\n\n\n\n\n\nQ7\nFitting the age variable included in the dataset as a factor introduces three parameters into the model. Would it be reasonable to treat the age variable as continuous and thus reduce the number of parameters in the model? How would you assess this?\n\n\nShow the code\ntbl_ordinal &lt;- glm(disc2 ~ as.numeric(age)+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \ntbl_cat &lt;- glm(disc2 ~ age+ offset(log(pyrs)),\n    family = poisson,\n    data = ondrate) \nlmtest::lrtest(tbl_ordinal,tbl_cat)\n\n\nLikelihood ratio test\n\nModel 1: disc2 ~ as.numeric(age) + offset(log(pyrs))\nModel 2: disc2 ~ age + offset(log(pyrs))\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   2   -264                    \n2   4   -263  2  2.14       0.34\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe likelihood ratio test shows no evidence against (or in favor) of using age as ordinal (linear)\n\n\n\n\n\nQ8\nOpen whitehal.dta and use Poisson regression to repeat the analyses in question 11 of practical 5, i.e. examine the effect of job grade on CHD mortality adjusted for ageband and smoking status simultaneously. How does the result obtained from Poisson regression compare to that obtained using the stmh command?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nQ11 of Session 6 already has it",
    "crumbs": [
      "Home",
      "07: Poisson regression for cohort studies"
    ]
  },
  {
    "objectID": "ASME_02.html",
    "href": "ASME_02.html",
    "title": "2: Review of Logistic Regression",
    "section": "",
    "text": "All code solutions are hidden by default, you can see the underlying code clicking in “Show the code”",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#a",
    "href": "ASME_02.html#a",
    "title": "2: Review of Logistic Regression",
    "section": "2a",
    "text": "2a\n\nObtain a frequency table of npa. What is the most commonly occurring number of lifetime sexual partners? Where npa is missing (9) recode to STATA’s own missing value code (.) using the command mvdecode or recode. Form a cross-tabulation of number of lifetime sexual partners with HIV status.\n\n\n\nShow the code\nmwanza |&gt; tbl_summary(include = c(npa))\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nN = 7631\n\n\n\n\nnpa\n\n\n\n\n    1\n200 (27%)\n\n\n    2\n369 (50%)\n\n\n    3\n123 (17%)\n\n\n    4\n43 (5.9%)\n\n\n    Unknown\n28\n\n\n\n1 n (%)\n\n\n\n\n\n\n\n\nWhat is the most common number of lifetime sexual partners?\nCross-tabulate number of lifetime sexual partners with HIV status.\n\n\nShow the code\nmwanza |&gt; tbl_summary(include = c(npa), by = case)\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n0 N = 5741\n1 N = 1891\n\n\n\n\nnpa\n\n\n\n\n\n\n    1\n173 (31%)\n27 (15%)\n\n\n    2\n277 (50%)\n92 (50%)\n\n\n    3\n83 (15%)\n40 (22%)\n\n\n    4\n19 (3.4%)\n24 (13%)\n\n\n    Unknown\n22\n6\n\n\n\n1 n (%)",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#b",
    "href": "ASME_02.html#b",
    "title": "2: Review of Logistic Regression",
    "section": "2b",
    "text": "2b\n\nFit a logistic model to estimate the strength of association between npa and HIV status, treating npa as a factor. Is there evidence for an association between npa and HIV? What do you conclude?\n\n\n\nShow the code\nglm(case ~ npa,\n    family = binomial,\n    data = mwanza) |&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nnpa\n\n\n\n\n&lt;0.001\n\n\n    1\n—\n—\n\n\n\n\n    2\n2.13\n1.35, 3.46\n0.002\n\n\n    3\n3.09\n1.78, 5.42\n&lt;0.001\n\n\n    4\n8.09\n3.95, 17.0\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\nIs there evidence of association?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThere is strong evidence of an association between the number of lifetime partners and being HIV positive.",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#c",
    "href": "ASME_02.html#c",
    "title": "2: Review of Logistic Regression",
    "section": "2c",
    "text": "2c\nA more convenient way to fit this model is to use the most prevalent group as a baseline. Which group was used in (b)? Why does it make sense to use the most prevalent group as baseline? Refit the model using the most prevalent group as baseline.\n\n\nShow the code\n# Relevel the factor\nmwanza &lt;- mwanza |&gt; \n  # the first argument of fct_relevel is the variable and the second argument the level you \n  # want to be the reference level\n  mutate(npa = fct_relevel(npa,\"2\")) \n\n# Logistic regression (unchanged)\nglm(case ~ npa,\n    family = binomial,\n    data = mwanza) |&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nnpa\n\n\n\n\n&lt;0.001\n\n\n    2\n—\n—\n\n\n\n\n    1\n0.47\n0.29, 0.74\n0.002\n\n\n    3\n1.45\n0.92, 2.26\n0.10\n\n\n    4\n3.80\n2.00, 7.34\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nIf we use the most prevalent group as the baseline, then the SEs for the \\(\\beta\\)s (log(OR)) will be smaller.",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#d",
    "href": "ASME_02.html#d",
    "title": "2: Review of Logistic Regression",
    "section": "2d",
    "text": "2d\nAmend your model to control for the confounding effect of age treated as a factor (age1).\n\n\nShow the code\nglm(case ~ npa + age1,\n    family = binomial,\n    data = mwanza) |&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nnpa\n\n\n\n\n&lt;0.001\n\n\n    2\n—\n—\n\n\n\n\n    1\n0.51\n0.31, 0.81\n0.006\n\n\n    3\n1.30\n0.82, 2.04\n0.3\n\n\n    4\n4.75\n2.43, 9.47\n&lt;0.001\n\n\nage1\n\n\n\n\n&lt;0.001\n\n\n    1\n—\n—\n\n\n\n\n    2\n3.27\n1.69, 6.69\n&lt;0.001\n\n\n    3\n2.50\n1.24, 5.28\n0.013\n\n\n    4\n1.93\n0.93, 4.15\n0.082\n\n\n    5\n1.26\n0.61, 2.73\n0.5\n\n\n    6\n0.81\n0.35, 1.87\n0.6\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\nShow the code\n# if you want to see the more details about the overall signficance of each variable\n# anova(glm(case ~ npa + age1,\n#     family = binomial,\n#     data = mwanza))\n\n\nWhat is your conclusion?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nAdding age1 to the model changes the odds ratios for npa (0.51, 1.30, 4.75) showing the confounding effect of age. After adjusting for age, there is strong evidence that npa is associated with being a case (LRT gives X32=35.44, p&lt;0.001).",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#e.-summary-table",
    "href": "ASME_02.html#e.-summary-table",
    "title": "2: Review of Logistic Regression",
    "section": "2e. Summary table",
    "text": "2e. Summary table\nSummarise the results of the analyses conducted above in a table - show the distribution of number of partners in cases and controls, odds ratios (unadjusted and age-adjusted effect of number of lifetime partners in a table), 95% CIs, p-values.\n\n\nShow the code\n# you can do all three itens in almost one line of code (in R)\n\nlibrary(finalfit)\n\nexplanatory = c(\"npa\", \"age1\")\ndependent = \"case\"\nmwanza |&gt; \n    finalfit(dependent, explanatory) -&gt; table1\nknitr::kable(table1, row.names=FALSE, align=c(\"l\", \"l\", \"r\", \"r\", \"r\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\nDependent: case\n\n0\n1\nOR (univariable)\nOR (multivariable)\n\n\n\n\nnpa\n2\n277 (75.1)\n92 (24.9)\n-\n-\n\n\n\n1\n173 (86.5)\n27 (13.5)\n0.47 (0.29-0.74, p=0.002)\n0.51 (0.31-0.81, p=0.006)\n\n\n\n3\n83 (67.5)\n40 (32.5)\n1.45 (0.92-2.26, p=0.101)\n1.30 (0.82-2.04, p=0.264)\n\n\n\n4\n19 (44.2)\n24 (55.8)\n3.80 (2.00-7.34, p&lt;0.001)\n4.75 (2.43-9.47, p&lt;0.001)\n\n\nage1\n1\n96 (88.1)\n13 (11.9)\n-\n-\n\n\n\n2\n108 (65.5)\n57 (34.5)\n3.90 (2.07-7.84, p&lt;0.001)\n3.27 (1.69-6.69, p=0.001)\n\n\n\n3\n84 (68.3)\n39 (31.7)\n3.43 (1.75-7.08, p&lt;0.001)\n2.50 (1.24-5.28, p=0.013)\n\n\n\n4\n85 (72.0)\n33 (28.0)\n2.87 (1.45-5.98, p=0.003)\n1.93 (0.93-4.15, p=0.082)\n\n\n\n5\n107 (78.1)\n30 (21.9)\n2.07 (1.04-4.32, p=0.044)\n1.26 (0.61-2.73, p=0.539)\n\n\n\n6\n94 (84.7)\n17 (15.3)\n1.34 (0.62-2.95, p=0.465)\n0.81 (0.35-1.87, p=0.612)",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#a-1",
    "href": "ASME_02.html#a-1",
    "title": "2: Review of Logistic Regression",
    "section": "3a",
    "text": "3a\nThe risk of HIV associated with npa is confounded by attending school (using ed2)\n\n\nShow the code\nglm(case ~ npa + age1 + ed2,\n    family = binomial,\n    data = mwanza) |&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nnpa\n\n\n\n\n&lt;0.001\n\n\n    2\n—\n—\n\n\n\n\n    1\n0.50\n0.30, 0.81\n0.006\n\n\n    3\n1.24\n0.78, 1.96\n0.4\n\n\n    4\n4.38\n2.22, 8.82\n&lt;0.001\n\n\nage1\n\n\n\n\n0.003\n\n\n    1\n—\n—\n\n\n\n\n    2\n3.20\n1.66, 6.56\n&lt;0.001\n\n\n    3\n2.62\n1.30, 5.56\n0.009\n\n\n    4\n2.28\n1.09, 4.97\n0.031\n\n\n    5\n1.59\n0.75, 3.49\n0.2\n\n\n    6\n1.26\n0.52, 3.06\n0.6\n\n\ned2\n\n\n\n\n0.001\n\n\n    0\n—\n—\n\n\n\n\n    1\n1.97\n1.30, 3.04\n0.002\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nEducational status does not appear to be a strong confounder of the relationship between npa and HIV-infection, after adjusting for age1 as the adjusted ORs are 0.50, 1.24, and 4.38, in similar to the adjusted ORs reported in 2",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#b.",
    "href": "ASME_02.html#b.",
    "title": "2: Review of Logistic Regression",
    "section": "3b.",
    "text": "3b.\nThere is any evidence the risk of HIV associated with npa differs according to whether the women had attended school.\n\n\nShow the code\n# Model with interaction\nlogit_inter &lt;- glm(case ~ npa * ed2 + age1,\n    family = binomial,\n    data = mwanza)\n\n# Model without interaction\nlogit_without &lt;- glm(case ~ npa + ed2 + age1,\n    family = binomial,\n    data = mwanza)\n\n# Likelihood ratio test\nlmtest::lrtest(logit_without, logit_inter)\n\n\nLikelihood ratio test\n\nModel 1: case ~ npa + ed2 + age1\nModel 2: case ~ npa * ed2 + age1\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1  10   -374                    \n2  13   -373  3   0.5       0.92\n\n\nShow the code\n# Note that ANOVA gives you the same χ statistic and df\n#anova(logit_without, logit_inter)\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nLRT gives \\(\\chi_{3}^2\\)=0.50, p=0.92 suggesting data are compatible with no interaction between lifetime partners and educational status on HIV status.",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#a-2",
    "href": "ASME_02.html#a-2",
    "title": "2: Review of Logistic Regression",
    "section": "4a",
    "text": "4a\nFit a model including npa, age1 and their interaction, all terms treated as categorical variables.\n\nWhat happens when you carry out a LR test of the interaction term?\n\n\n\nShow the code\n# You will get multiple warnings of non convergence / fitted probabilities of 0/1\nglm(case ~ npa * age1,\n    family = binomial,\n    data = mwanza)|&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nnpa\n\n\n\n\n0.025\n\n\n    2\n—\n—\n\n\n\n\n    1\n0.44\n0.10, 1.78\n0.2\n\n\n    3\n6.40\n1.19, 36.7\n0.030\n\n\n    4\n0.00\n\n\n&gt;0.9\n\n\nage1\n\n\n\n\n&lt;0.001\n\n\n    1\n—\n—\n\n\n\n\n    2\n3.98\n1.52, 12.6\n0.009\n\n\n    3\n3.20\n1.14, 10.5\n0.037\n\n\n    4\n2.23\n0.77, 5.40\n0.2\n\n\n    5\n1.60\n0.55, 5.32\n0.4\n\n\n    6\n0.70\n0.24, 2.60\n0.6\n\n\nnpa * age1\n\n\n\n\n0.2\n\n\n    1 * 2\n1.06\n0.20, 5.62\n&gt;0.9\n\n\n    3 * 2\n0.22\n0.03, 1.43\n0.11\n\n\n    4 * 2\n97,773\n0.00,\n\n&gt;0.9\n\n\n    1 * 3\n0.62\n0.08, 4.12\n0.6\n\n\n    3 * 3\n0.18\n0.04, 1.20\n0.076\n\n\n    4 * 3\n1,217,553\n0.00,\n\n&gt;0.9\n\n\n    1 * 4\n1.62\n0.24, 10.5\n0.6\n\n\n    3 * 4\n0.18\n0.02, 1.33\n0.095\n\n\n    4 * 4\n523,548\n0.00,\n\n&gt;0.9\n\n\n    1 * 5\n0.70\n0.07, 5.21\n0.7\n\n\n    3 * 5\n0.10\n0.01, 0.81\n0.035\n\n\n    4 * 5\n1,095,798\n0.00,\n\n&gt;0.9\n\n\n    1 * 6\n5.19\n0.77, 35.7\n0.088\n\n\n    3 * 6\n0.20\n0.02, 2.81\n0.3\n\n\n    4 * 6\n478,324\n0.00,\n\n&gt;0.9\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\n\nTabulate the number of cases in each grouping of npa vs age1 (see note below).\n\n\n\nShow the code\nmwanza |&gt; tbl_summary(include = c(age1), by = npa)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n2 N = 3691\n1 N = 2001\n3 N = 1231\n4 N = 431\n\n\n\n\nage1\n\n\n\n\n\n\n\n\n\n\n    1\n37 (10%)\n62 (31%)\n8 (6.5%)\n1 (2.3%)\n\n\n    2\n86 (23%)\n40 (20%)\n28 (23%)\n3 (7.0%)\n\n\n    3\n57 (15%)\n25 (13%)\n33 (27%)\n6 (14%)\n\n\n    4\n58 (16%)\n20 (10%)\n24 (20%)\n10 (23%)\n\n\n    5\n70 (19%)\n28 (14%)\n22 (18%)\n13 (30%)\n\n\n    6\n61 (17%)\n25 (13%)\n8 (6.5%)\n10 (23%)\n\n\n\n1 n (%)\n\n\n\n\n\n\n\n\n\nWhat is the problem and how can it be resolved? ::: {.callout-note collapse=“true”} ## Answer\n\nThis problem arises because there are no cases in the highest sex partner group and the youngest age group. Sparse data (bias), other names is complete/quasi separation problem. :::",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_02.html#b-1",
    "href": "ASME_02.html#b-1",
    "title": "2: Review of Logistic Regression",
    "section": "4b",
    "text": "4b\nIn order to test for interaction we need to combine npa group 4 with npa group 3. Generate a new variable (eg npa2) with this regrouping. Refit the interaction model using npa2 in place of npa. Is there evidence of any interaction?\n\n\nShow the code\n# Create a new variable, relevel and label\nmwanza &lt;- mwanza |&gt; \n  mutate(partners = case_when(npa == \"1\" ~ \"&lt;=1\",\n              npa == \"2\" ~ \"2-4\",\n              npa == \"3\" | npa == \"4\" ~ \"&gt;=5\"),\n    partners = fct_relevel(partners,\"2-4\")\n  )\n\n# Check it worked well\nmwanza |&gt; tbl_summary(include = c(age1), by = partners)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n2-4 N = 3691\n&lt;=1 N = 2001\n&gt;=5 N = 1661\n\n\n\n\nage1\n\n\n\n\n\n\n\n\n    1\n37 (10%)\n62 (31%)\n9 (5.4%)\n\n\n    2\n86 (23%)\n40 (20%)\n31 (19%)\n\n\n    3\n57 (15%)\n25 (13%)\n39 (23%)\n\n\n    4\n58 (16%)\n20 (10%)\n34 (20%)\n\n\n    5\n70 (19%)\n28 (14%)\n35 (21%)\n\n\n    6\n61 (17%)\n25 (13%)\n18 (11%)\n\n\n\n1 n (%)\n\n\n\n\n\n\n\n\nShow the code\nglm(case ~ partners * age1,\n    family = binomial,\n    data = mwanza)|&gt; \n  tbl_regression(exponentiate = T) |&gt; \n  add_global_p(keep=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\npartners\n\n\n\n\n0.018\n\n\n    2-4\n—\n—\n\n\n\n\n    &lt;=1\n0.44\n0.10, 1.78\n0.2\n\n\n    &gt;=5\n5.12\n0.99, 27.1\n0.048\n\n\nage1\n\n\n\n\n&lt;0.001\n\n\n    1\n—\n—\n\n\n\n\n    2\n3.98\n1.52, 12.6\n0.009\n\n\n    3\n3.20\n1.14, 10.5\n0.037\n\n\n    4\n2.23\n0.77, 7.44\n0.2\n\n\n    5\n1.60\n0.55, 5.32\n0.4\n\n\n    6\n0.70\n0.20, 2.60\n0.6\n\n\npartners * age1\n\n\n\n\n0.5\n\n\n    &lt;=1 * 2\n1.06\n0.20, 5.62\n&gt;0.9\n\n\n    &gt;=5 * 2\n0.26\n0.04, 1.62\n0.14\n\n\n    &lt;=1 * 3\n0.62\n0.08, 4.12\n0.6\n\n\n    &gt;=5 * 3\n0.30\n0.05, 1.90\n0.2\n\n\n    &lt;=1 * 4\n1.62\n0.24, 10.5\n0.6\n\n\n    &gt;=5 * 4\n0.35\n0.05, 2.25\n0.3\n\n\n    &lt;=1 * 5\n0.70\n0.07, 5.21\n0.7\n\n\n    &gt;=5 * 5\n0.41\n0.06, 2.65\n0.3\n\n\n    &lt;=1 * 6\n5.19\n0.77, 35.7\n0.088\n\n\n    &gt;=5 * 6\n0.51\n0.06, 4.33\n0.5\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\nShow the code\n# Model with interaction\nlogit_inter &lt;- glm(case ~ partners * age1,\n    family = binomial,\n    data = mwanza)\n\n# Model without interaction\nlogit_without &lt;- glm(case ~ partners + age1,\n    family = binomial,\n    data = mwanza)\n\n# Likelihood ratio test\nlmtest::lrtest(logit_without, logit_inter)\n\n\nLikelihood ratio test\n\nModel 1: case ~ partners + age1\nModel 2: case ~ partners * age1\n  #Df LogLik Df Chisq Pr(&gt;Chisq)\n1   8   -385                    \n2  18   -380 10  9.43       0.49\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nUsing partners variable in the analysis and conducting the interaction and no interaction model, the data are compatible with null hypothesis of no interaction: LRT gives \\(\\chi_{10}^2\\)=9.43, p=0.49.",
    "crumbs": [
      "Home",
      "2: Review of Logistic Regression"
    ]
  },
  {
    "objectID": "ASME_10.html",
    "href": "ASME_10.html",
    "title": "10: Analysis of correlated outcome data",
    "section": "",
    "text": "Show the code\nlibrary(haven) \n# create table\nlibrary(gtsummary)\n# data wrangling and other functions\nlibrary(tidyverse)\n# if you want to have a output similar to stata\nlibrary(tidylog)\n#cox\nlibrary(survival)\n# plots survival\nlibrary(ggsurvfit)\n# Limit significant digits to 2, remove scientific notation\noptions(digits = 2, scipen = 9)\n\npapua &lt;- read_dta(\"datasets/pngnew.dta\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n\n\nIn the first part of the practical we examine data from a pneumococcal vaccine trial performed in Papua New Guinea (pngnew.dta). The data are arranged by episode, so that each child in the trial may have several records, one for each episode of clinical pneumonia (without laboratory confirmation of pneumococcal infection) and, usually, one for the period from their last episode until they exited the trial. Thus, for each child we have data on the number of episodes they experienced (the numerator) and the length of time for which they were followed up (the denominator). We can thus calculate rates and rate ratios and an appropriate statistical model is a Poisson regression model with a random effect to account for between child variability in susceptibility/exposure.\n\n\n\n\n\n\nNote\n\n\n\nThese data are from a pneumococcal vaccine trial performed in Papua New Guinea, assessing the vaccine efficacy in preventing clinical episodes of pneumonia among children.\nEach child might have more than one record, because each record represents an episode of pneumonia (or the last period of follow-up, without pneumonia).\n*Outcome* : any indicates whether the current period of observation ended in an episode or not\n*Exposure* : vacc (vaccination: 1 = placebo, 2 = vaccine)\n*Cluster* : id (child)\n*Time* : -timein (date of entry in this follow-up period) -timeout (date of exit from this follow-up period) -dob (date of birth)\n*Other* - sex (1 = male, 2 = female) - anyprev (0: no previous episodes of pneumonia, 1: any prev. episodes)\n\n\n\nQ1\nEach child had a unique identification number (id) which identifies which records belong to which child. Examine the data for child id 2921:\n\n\nShow the code\npapua &lt;- papua |&gt; \n  mutate(sex = factor(sex, levels = c(1, 2), labels = c(\"male\", \"female\")),\n                 vacc = factor(vacc, levels = c(1, 2), labels = c(\"placebo\", \"vaccine\")),\n                 pyrs = as.numeric(timeout - timein) / 365.25)\n\n\npapua |&gt; \n  filter(id==2921)\n\n\n# A tibble: 5 × 10\n     id sex   vacc      any anyprev timein     timeout    dob        datevac   \n  &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    \n1  2921 male  placebo     1       0 1981-10-26 1982-04-07 1976-12-08 1981-10-26\n2  2921 male  placebo     1       1 1982-04-07 1982-10-18 1976-12-08 1981-10-26\n3  2921 male  placebo     1       2 1982-10-18 1983-05-04 1976-12-08 1981-10-26\n4  2921 male  placebo     1       3 1983-05-04 1983-05-25 1976-12-08 1981-10-26\n5  2921 male  placebo     0       4 1983-05-25 1983-11-30 1976-12-08 1981-10-26\n# ℹ 1 more variable: pyrs &lt;dbl&gt;\n\n\n\n\nQ2\nIndividual children can have multiple records in the database, depending on how many episodes of clinical pneumonia they experienced. Use the following commands to examine the number of children in each vaccine group and the number of episodes per child\n\n\nShow the code\npapua |&gt; group_by(id) |&gt; \n  summarise(episodes = sum(any),\n            vacc = max(as.numeric(vacc))) |&gt; \n  mutate(episodes = as.character(episodes)) |&gt; \n  tbl_summary(include = episodes, by = vacc)\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n1 N = 7191\n2 N = 6711\n\n\n\n\nepisodes\n\n\n\n\n\n\n    0\n225 (31%)\n242 (36%)\n\n\n    1\n183 (25%)\n155 (23%)\n\n\n    10\n0 (0%)\n1 (0.1%)\n\n\n    11\n2 (0.3%)\n0 (0%)\n\n\n    2\n131 (18%)\n114 (17%)\n\n\n    3\n73 (10%)\n72 (11%)\n\n\n    4\n53 (7.4%)\n46 (6.9%)\n\n\n    5\n24 (3.3%)\n23 (3.4%)\n\n\n    6\n14 (1.9%)\n6 (0.9%)\n\n\n    7\n10 (1.4%)\n5 (0.7%)\n\n\n    8\n3 (0.4%)\n4 (0.6%)\n\n\n    9\n1 (0.1%)\n3 (0.4%)\n\n\n\n1 n (%)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nCompared to STATA, you dont need to worry about the dataset being modified unintentionally (R&gt;Stata). The coding is grouping the individuals by id and doing operations in each small dataset (all rows from each id). sum(any) sums all values in the “any” variable, max(as.numeric(vacc)) is a workaround of recovering the group, as each participant is either vaccinated or unvaccinated. This approach wouldn’t work if the participant could be vaccinated after enter the study\n\n\n\nDetermine how many episodes there were in total in each vaccine group\n\n\nShow the code\npapua |&gt; group_by(vacc) |&gt; summarise(episodes = sum(any))\n\n\n# A tibble: 2 × 2\n  vacc    episodes\n  &lt;fct&gt;      &lt;dbl&gt;\n1 placebo     1205\n2 vaccine     1038\n\n\n\n\nQ3\nThings you dont need to do in R.\n\n\nQ4\nExamine the incidence rates in the vaccinated and unvaccinated groups, and to calculate a rate ratio, ignoring any within-child clustering.\n\n\nShow the code\npyears(Surv(pyrs,any) ~ vacc, data = papua, scale = 1) %&gt;%\n  summary(n = F, rate = T, ci.r = T, scale = 100)\n\n\nCall: pyears(formula = Surv(pyrs, any) ~ vacc, data = papua, scale = 1)\n\nnumber of observations = 3627\n\n  vacc     Events   Time   Event rate   CI (rate)  \n--------- -------- ------ ------------ ----------- \n placebo    1205    1217       99       94 - 105  \n vaccine    1038    1160       90       84 -  95  \n\n\nRate ratio (using Poisson and not MH - Stata solution)\n\n\nShow the code\ndt_pois &lt;- (pyears(Surv(pyrs,any) ~ vacc, data = papua, scale = 1,\n       data.frame = T))$data \n  glm(event~vacc + offset(log(pyears)), family=poisson,\n      data=dt_pois) |&gt; \n    tbl_regression(exponentiate = T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nIRR\n95% CI\np-value\n\n\n\n\nvacc\n\n\n\n\n\n\n\n\n    placebo\n—\n—\n\n\n\n\n    vaccine\n0.90\n0.83, 0.98\n0.017\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\nShow the code\n    glm(event~vacc + offset(log(pyears)), family=poisson,\n      data=dt_pois) |&gt; \n    tbl_regression(exponentiate = F) |&gt; \n    modify_column_unhide(column = std.error) #trick to show SE\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nlog(IRR)\nSE\n95% CI\np-value\n\n\n\n\nvacc\n\n\n\n\n\n\n\n\n\n\n    placebo\n—\n—\n—\n\n\n\n\n    vaccine\n-0.10\n0.042\n-0.18, -0.02\n0.017\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio, SE = Standard Error\n\n\n\n\n\n\n\n\n\n\nQ5\nRefit the Poisson regression model, this time asking Stata to compute robust standard errors adjusted for clustering. What impact does taking account of the clustering have on your interpretation of the vaccine’s effect?\nWe have multiple options to calculate cluster robust SE in R.\n\n\nShow the code\n# Using the miceadds package (not my preferred option)\n# pois_rob &lt;- miceadds::glm.cluster(papua,\n#                         any ~ vacc + offset(log(pyrs)),\n#                         cluster = \"id\",\n#                         family = \"poisson\")\n# summary(pois_rob)\n\n\n\n\nShow the code\n# using sandwich and lmtest\nlibrary(sandwich)\nlibrary(lmtest)\npois_no_cluster &lt;- glm(any ~ vacc + offset(log(pyrs)),\n                family = \"poisson\",\n                data = papua)\ncoeftest(pois_no_cluster, vcov = vcovCL, cluster = ~ id)\n\n\n\nz test of coefficients:\n\n            Estimate Std. Error z value Pr(&gt;|z|)  \n(Intercept) -0.00973    0.04172   -0.23    0.816  \nvaccvaccine -0.10117    0.06087   -1.66    0.097 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\nShow the code\n# using parameters::model_parameters (requires sandwich package)\nparameters::model_parameters(\n  pois_no_cluster,\n  vcov = \"vcovCL\",\n  vcov_args = list(cluster=papua$id),\n  exponentiate=T\n)\n\n\nParameter      |  IRR |   SE |       95% CI |     z |     p\n-----------------------------------------------------------\n(Intercept)    | 0.99 | 0.04 | [0.91, 1.07] | -0.23 | 0.816\nvacc [vaccine] | 0.90 | 0.06 | [0.80, 1.02] | -1.66 | 0.097\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe SE increased from 0.042 to 0.061 (log IRR)\n\n\n\n\n\nQ6\nNow fit a random effects model to take account of within child clustering.\n\n\nShow the code\nmod_gamma &lt;- coxph(Surv(pyrs, any) ~ vacc + frailty(id, \n    distribution = \"gamma\"), data = papua)\ntbl_regression(mod_gamma,\n               exponentiate = T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nHR\n95% CI\np-value\n\n\n\n\nvacc\n\n\n\n\n\n\n\n\n    placebo\n—\n—\n\n\n\n\n    vaccine\n0.88\n0.77, 1.00\n0.046\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nWe are using a Cox regression with a fraitly term. In the stata exercise, it has been calculated using a parametric model\n\n\n\n\n\nQ7\n\n\nShow the code\nlibrary(lme4)\n# Fit model\npois_re &lt;- glmer(any ~ vacc + offset(log(pyrs)) + (1|id),\n                 data = papua,\n                 family = \"poisson\")\n\nsummary(pois_re)\n\n\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: poisson  ( log )\nFormula: any ~ vacc + offset(log(pyrs)) + (1 | id)\n   Data: papua\n\n     AIC      BIC   logLik deviance df.resid \n    9758     9777    -4876     9752     3624 \n\nScaled residuals: \n   Min     1Q Median     3Q    Max \n-1.554 -0.654  0.095  1.021 17.376 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n id     (Intercept) 0.673    0.821   \nNumber of obs: 3627, groups:  id, 1390\n\nFixed effects:\n            Estimate Std. Error z value    Pr(&gt;|z|)    \n(Intercept)  -0.2704     0.0477   -5.67 0.000000014 ***\nvaccvaccine  -0.1213     0.0648   -1.87       0.061 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr)\nvaccvaccine -0.632\n\n\n\n\nShow the code\n# Output\nbroom.mixed::tidy(pois_re,\n     conf.int = TRUE,\n     exponentiate = TRUE,\n     effects = \"fixed\")\n\n\n# A tibble: 2 × 8\n  effect term        estimate std.error statistic     p.value conf.low conf.high\n  &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;\n1 fixed  (Intercept)    0.763    0.0364     -5.67     1.43e-8    0.695     0.838\n2 fixed  vaccvaccine    0.886    0.0574     -1.87     6.10e-2    0.780     1.01 \n\n\n\n\nQ8\nFit the model using age, instead time since study entry\n\n\nShow the code\nmod_gamma &lt;- coxph(Surv(time = as.numeric(timein),\n                        time2 = as.numeric(timeout),\n                        origin = as.numeric(dob),\n                        any) ~ vacc + frailty(id, \n    distribution = \"gamma\"), data = papua)\ntbl_regression(mod_gamma,\n               exponentiate = T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nHR\n95% CI\np-value\n\n\n\n\nvacc\n\n\n\n\n\n\n\n\n    placebo\n—\n—\n\n\n\n\n    vaccine\n0.91\n0.83, 1.01\n0.078\n\n\n\nAbbreviations: CI = Confidence Interval, HR = Hazard Ratio\n\n\n\n\n\n\n\n\n\n\nQ9\nRefit the random effects model also adjusting for age and sex.\n\n\nShow the code\npapua &lt;- papua |&gt; \n  mutate(age_years = as.numeric((timein - dob)/365.25))\npois_re &lt;- glmer(any ~ vacc + offset(log(pyrs)) + \n                   age_years+\n                   sex+\n                   (1|id),\n                 data = papua,\n                 family = \"poisson\")\n\npapua&lt;- papua |&gt; \n  mutate(agegrp = cut(age_years,\n                              breaks = c(0, 1, 2, 3, 4,+Inf),\n                              labels = c(\"0-1yr,\", \"1-2yr\", \"2-3yr\", \"3-4yr\", \"&gt;=4yr\")))\n# Output\ntbl_cont &lt;- pois_re |&gt; \n  tbl_regression(exponentiate=T)\n\npois_re_grp &lt;- glmer(any ~ vacc + offset(log(pyrs)) + \n                   agegrp+\n                     sex+\n                   (1|id),\n                 data = papua,\n                 family = \"poisson\")\n\ntbl_cat &lt;- pois_re_grp |&gt; \n  tbl_regression(exponentiate=T)\n\ntbl_merge(\n  list(tbl_cont, tbl_cat),\n  tab_spanner = c(\"Continuous age\",\"Categorical age\")\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nContinuous age\n\n\nCategorical age\n\n\n\nIRR\n95% CI\np-value\nIRR\n95% CI\np-value\n\n\n\n\nvacc\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    placebo\n—\n—\n\n\n—\n—\n\n\n\n\n    vaccine\n0.90\n0.81, 1.01\n0.073\n0.91\n0.82, 1.02\n0.10\n\n\nage_years\n0.63\n0.61, 0.66\n&lt;0.001\n\n\n\n\n\n\n\n\nsex\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    male\n—\n—\n\n\n—\n—\n\n\n\n\n    female\n1.02\n0.91, 1.14\n0.7\n1.02\n0.92, 1.14\n0.7\n\n\nagegrp\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    0-1yr,\n\n\n\n\n\n\n—\n—\n\n\n\n\n    1-2yr\n\n\n\n\n\n\n0.67\n0.59, 0.76\n&lt;0.001\n\n\n    2-3yr\n\n\n\n\n\n\n0.41\n0.35, 0.47\n&lt;0.001\n\n\n    3-4yr\n\n\n\n\n\n\n0.29\n0.25, 0.34\n&lt;0.001\n\n\n    &gt;=4yr\n\n\n\n\n\n\n0.16\n0.14, 0.19\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, IRR = Incidence Rate Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nControlling for age and sex results in an adjusted rate ratio of 0.91, compared with an unadjusted rate ratio of 0.88. The evidence for a vaccine effect has weakened a little (P-value is now 0.10). Given that this was a fairly large RCT we would not expect strong confounding by age or sex (this can be checked by cross-tabulating age and sex at enrolment against vaccine group).\n\n\n\n\n\nQ10\nOpen the data set (hhtb.dta) and explore the dataset (glimpse) or click on it in the environment tab.\n\nOutcome : mantoux (tuberculin test result: 0 = negative, 1 = positive)\nExposure: cough (duration of cough in index case: 1 = &lt;2 months, 2 = &gt;=2 months)\nCluster: id (household, so = index case)\nhiv - hiv (HIV status of index case: 1 = negative, 2 = positive)\nage group: agegrp (age of contact, in years)\n\n\n\nShow the code\nhhtb &lt;- read_dta(\"datasets/HHTB.DTA\") |&gt; \n  mutate(across(where(is.labelled),as_factor))\n\n#glimpse(hhtb)\n\n\n\n\nQ11\nEach record represents an individual household contact of a TB case. The variable id indicates which household contacts belong to the same household (and hence are contacts of the same index case). Use the following commands to examine the distribution of contacts per household by HIV status of the index case.\n\n\nShow the code\nhhtb |&gt; \n  group_by(id, hiv) |&gt; \n  count(mantoux) |&gt; \n  filter(mantoux==1) |&gt; \n  mutate(hiv= as.factor(hiv)) |&gt; \n  ggplot()+\n  geom_histogram(aes(n, fill=hiv),\n                 position = \"dodge\")+\n  scale_x_continuous(breaks = seq(1:10))\n\n\n\n\n\n\n\n\n\nShow the code\n# same answer from stata\n# hhtb |&gt; \n#   group_by(id) |&gt; \n#   count(hiv) |&gt; \n#   filter(!is.na(hiv)) |&gt;\n#   ungroup() |&gt; \n#   mutate(n = factor(n, sort(unique(n)), ordered = T)) |&gt; \n#   tbl_summary(include = n, by = hiv)\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe answer in STATA show you the table. I would rather see the distribution with a histogram. Here is showing the distribution of number of cases (mantoux=1) per household and HIV status.\n\n\n\n\n\nQ12\nPerform a similar analysis to examine the distribution of contacts per household by duration of cough of the index case. Why are only 58 households shown?\n\n\nShow the code\nhhtb |&gt; \n  group_by(id) |&gt; \n  count(cough) |&gt; \n  filter(!is.na(cough)) |&gt;\n  ungroup() |&gt; \n  mutate(n = factor(n, sort(unique(n)), ordered = T)) |&gt; \n  tbl_summary(include = n, by = cough)\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n1 N = 321\n2 N = 261\n\n\n\n\nn\n\n\n\n\n\n\n    1\n5 (16%)\n2 (7.7%)\n\n\n    2\n3 (9.4%)\n5 (19%)\n\n\n    3\n5 (16%)\n7 (27%)\n\n\n    4\n5 (16%)\n4 (15%)\n\n\n    5\n4 (13%)\n2 (7.7%)\n\n\n    6\n2 (6.3%)\n4 (15%)\n\n\n    8\n3 (9.4%)\n1 (3.8%)\n\n\n    9\n2 (6.3%)\n1 (3.8%)\n\n\n    10\n1 (3.1%)\n0 (0%)\n\n\n    11\n1 (3.1%)\n0 (0%)\n\n\n    13\n1 (3.1%)\n0 (0%)\n\n\n\n1 n (%)\n\n\n\n\n\n\n\n\n\n\nQ13\nFor household contacts, examine the distribution of tuberculin positivity by the duration of cough in the index case. Ignoring any clustering, what is the estimated odds ratio and associated 95% c.i.? What would you conclude about the association between duration of cough in the index case and tuberculin positivity in household contacts on the basis of this analysis (if you were unaware of the clustering issue)?\n\n\nShow the code\ntable(hhtb$mantoux,hhtb$cough) |&gt; \n  fisher.test() \n\n\n\n    Fisher's Exact Test for Count Data\n\ndata:  table(hhtb$mantoux, hhtb$cough)\np-value = 0.04\nalternative hypothesis: true odds ratio is not equal to 1\n95 percent confidence interval:\n 1.0 3.1\nsample estimates:\nodds ratio \n       1.8 \n\n\nShow the code\ntab1 &lt;- table(hhtb$mantoux,\n              hhtb$cough)\nepiR::epi.2by2(dat = tab1, method = \"cohort.count\", conf.level = 0.95, units = 100, \n   interpret = FALSE, outcome = \"as.columns\")\n\n\n             Outcome +    Outcome -      Total                 Inc risk *\nExposed +           72           33        105     68.57 (58.78 to 77.28)\nExposed -           82           67        149     55.03 (46.68 to 63.18)\nTotal              154          100        254     60.63 (54.33 to 66.68)\n\nPoint estimates and 95% CIs:\n-------------------------------------------------------------------\nInc risk ratio                                 1.25 (1.03, 1.51)\nInc odds ratio                                 1.78 (1.06, 3.01)\nAttrib risk in the exposed *                   13.54 (1.59, 25.48)\nAttrib fraction in the exposed (%)            19.74 (2.51, 33.93)\nAttrib risk in the population *                5.60 (-4.40, 15.59)\nAttrib fraction in the population (%)         9.23 (0.49, 17.20)\n-------------------------------------------------------------------\nUncorrected chi2 test that OR = 1: chi2(1) = 4.729 Pr&gt;chi2 = 0.030\nFisher exact test that OR = 1: Pr&gt;chi2 = 0.037\n Wald confidence limits\n CI: confidence interval\n * Outcomes per 100 population units \n\n\nShow the code\nmod &lt;- glm(mantoux~ cough, family=binomial, data=hhtb)\nparameters::model_parameters(mod, exponentiate=T)\n\n\nParameter   | Odds Ratio |   SE |       95% CI |     z |     p\n--------------------------------------------------------------\n(Intercept) |       0.64 | 0.25 | [0.30, 1.36] | -1.16 | 0.247\ncough       |       1.78 | 0.48 | [1.06, 3.03] |  2.16 | 0.030\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nWe can get odds ratios through multiple ways. None of them matched with STATA solution (Why use MH when there is no stratification?!)\n\n\n\n\n\nQ14\nUsing the logit command, obtain a 95% confidence interval for the odds ratio based on the robust standard error taking account of clustering. Are your conclusions about the association between duration of cough in the index case and tuberculin positivity in household contacts different from question 13 above?\n\n\nShow the code\nparameters::model_parameters(\n  mod,\n  vcov = \"vcovCL\",\n  vcov_args = list(cluster=hhtb$id),\n  exponentiate=T\n)\n\n\nParameter   | Odds Ratio |   SE |       95% CI |     z |     p\n--------------------------------------------------------------\n(Intercept) |       0.64 | 0.32 | [0.24, 1.73] | -0.88 | 0.377\ncough       |       1.78 | 0.62 | [0.90, 3.52] |  1.67 | 0.096\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe confidence interval has widened to (0.90, 3.52) and we should be (even) more sceptical than before about the strength of evidence for an association (P having increased from 0.03 to 0.10). After taking clustering into account, there is only weak evidence against the null hypothesis.\n\n\n\n\n\nQ15\nNow estimate the odds ratio and obtain confidence intervals based on the GEE approach with robust standard errors and assuming an exchangeable correlation matrix. How do your results change from those in question 14?\n\n\nShow the code\nlibrary(geepack)\ndep_gee &lt;- geeglm(mantoux ~ cough,\n               data = drop_na(hhtb, cough),  #geeglm doesnt accept missing values\n               id = id, \n               family = \"binomial\",\n               corstr = \"exchangeable\")\nparameters::model_parameters(dep_gee, exponentiate=T)\n\n\nParameter   | Odds Ratio |   SE |       95% CI | Chi2(1) |     p\n----------------------------------------------------------------\n(Intercept) |       0.58 | 0.30 | [0.21, 1.60] |    1.10 | 0.294\ncough       |       1.88 | 0.65 | [0.95, 3.71] |    3.27 | 0.071\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe point estimate of the odds ratio for duration of cough is 1.87 with 95% c.i. (0.97, 3.60), P=0.07. The odds ratio is slightly larger than that obtained using only robust standard errors (1.78). The standard error of the log odds ratio is very similar to that obtained from the previous “robust” analysis (0.35 ~ 0.35).\nThe PI and CI in Stata is different: 1.88 with 95% c.i. (0.94, 3.73) (I dont know why)\n\n\n\n\n\nQ16\nUse the xtlogit command again, but this time with the re option, to fit a random effects model for tuberculin positivity in terms of the duration of cough in the index case. Is there evidence from this model of between-household variation (within-household correlation)? Use the quadchk,nooutput command to check the reliability of the estimates from the random effects model.\n\n\nShow the code\ntb_mixed &lt;-  glmer(mantoux ~ cough + (1|id),\n                 data = hhtb,\n                 family = \"binomial\")\n\ntbl_laplace &lt;- tb_mixed |&gt; \n  tbl_regression(exponentiate=T)\n\n\n# You can get using adptative Gaussian quadrature using this\ntb_mixed &lt;-  glmer(mantoux ~ cough + (1|id),\n                 data = hhtb,\n                 family = \"binomial\",\n                 nAGQ = 12)\ntbl_quadrad &lt;- tb_mixed |&gt; \n  tbl_regression(exponentiate=T)\n\ntbl_merge(\n  list(tbl_laplace,\n       tbl_quadrad),\n  tab_spanner = c(\"Laplace\",\"Adaptative\")\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\n\nLaplace\n\n\nAdaptative\n\n\n\nOR\n95% CI\np-value\nOR\n95% CI\np-value\n\n\n\n\nDuration of cough\n2.15\n0.96, 4.80\n0.061\n2.19\n0.94, 5.08\n0.069\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\nShow the code\n#m2 &lt;- GLMMadaptive::mixed_model(fixed = mantoux ~ cough, random = ~ 1 | id, data = hhtb,\n #                  family = binomial())\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe estimated odds ratio is 2.19 (95% c.i. 0.94, 5.08; P=0.07). The estimate of the odds ratio is larger than that obtained from the GEE analysis (1.88).\nPs.:The default of glmer function uses a Laplace approximation and not the adaptative Gaussian quadrature\n\n\n\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nI dont think there is a similar function as “quadchk” from Stata in R. You need to refit the model with different quadrature points (nAGQ)\n\n\n\n\n\nQ17\nUse a random effects model to investigate the association between duration of cough in the index case and odds of tuberculin positivity, controlling for the effect of index cases’ HIV status and the age of the household contact, taking account of within-household clustering. Write down some sentences to summarise and interpret your results.\n\n\nShow the code\nhhtb$agegrp &lt;- factor(hhtb$agegrp)\ntb_mixed &lt;-  glmer(mantoux ~ cough + hiv +agegrp+ (1|id),\n                 data = hhtb,\n                 family = \"binomial\",\n                 nAGQ = 12)\ntb_mixed |&gt; \n  tbl_regression(exponentiate=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nDuration of cough\n1.85\n0.79, 4.31\n0.2\n\n\nHIV status of index case\n0.29\n0.12, 0.70\n0.006\n\n\nagegrp\n\n\n\n\n\n\n\n\n    1\n—\n—\n\n\n\n\n    2\n1.45\n0.69, 3.02\n0.3\n\n\n    3\n4.57\n2.11, 9.89\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nIn this model we have controlled for both a cluster (household) level (HIV status of the index case) and an individual level covariate (age of the contact). “After controlling for the HIV status of the index case and the age of the contact, the OR for the association between duration of cough of 2+ months and mantoux positivity is 1.85. Compared to the OR from the unadjusted random effects model (2.19) the OR is somewhat reduced suggesting some counfounding by one or both of these variables.”\n\n\n\n\n\nQ18\nUse GEE to investigate the association between duration of cough in the index case and odds of tuberculin positivity, controlling for the effect of index cases’ HIV status and the age of the household contact, taking account of within-household clustering. What do you notice about the ORs compared to those obtained with the random effects model.\n\n\nShow the code\nlogit_gee &lt;- geepack::geeglm(mantoux ~ cough + hiv + agegrp,\n                          data = drop_na(hhtb, cough),\n                          id = id,\n                          family = \"binomial\",\n                          corstr = \"exchangeable\")\nlogit_gee_noage &lt;- geepack::geeglm(mantoux ~ cough + hiv,\n                          data = drop_na(hhtb, cough),\n                          id = id,\n                          family = \"binomial\",\n                          corstr = \"exchangeable\")\n\nlogit_gee |&gt; \n  tbl_regression(exponentiate=T)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCharacteristic\nOR\n95% CI\np-value\n\n\n\n\nDuration of cough\n1.64\n0.82, 3.30\n0.2\n\n\nHIV status of index case\n0.36\n0.18, 0.74\n0.005\n\n\nagegrp\n\n\n\n\n\n\n\n\n    1\n—\n—\n\n\n\n\n    2\n1.37\n0.68, 2.76\n0.4\n\n\n    3\n3.58\n2.26, 5.67\n&lt;0.001\n\n\n\nAbbreviations: CI = Confidence Interval, OR = Odds Ratio\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nAll of the ORs are closer to 1 than those when using random effects, as expected with a population average model.\n\n\n\n\n\nShow the code\nanova(logit_gee, logit_gee_noage)\n\n\nAnalysis of 'Wald statistic' Table\n\nModel 1 mantoux ~ cough + hiv + agegrp \nModel 2 mantoux ~ cough + hiv\n  Df X2  P(&gt;|Chi|)    \n1  2 31 0.00000019 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nThe null hypothesis is that after taking account of the index case’s HIV status and cough duration there is no association between the age of the household contact and their Mantoux test status. The alternative hypothesis is that after taking account of the index case’s HIV status and cough duration there is an association between the age of the household contact and their Mantoux test status. There is strong evidence against the null. Note that the test has 2 df because we are testing simultaneously that 2 ORs are both equal to 1.",
    "crumbs": [
      "10: Analysis of correlated outcome data"
    ]
  },
  {
    "objectID": "ASME_10.html#point-estimates-and-95-cis",
    "href": "ASME_10.html#point-estimates-and-95-cis",
    "title": "10: Analysis of correlated outcome data",
    "section": "Point estimates and 95% CIs:",
    "text": "Point estimates and 95% CIs:\nInc risk ratio 1.25 (1.03, 1.51) Inc odds ratio 1.78 (1.06, 3.01) Attrib risk in the exposed * 13.54 (1.59, 25.48) Attrib fraction in the exposed (%) 19.74 (2.51, 33.93) Attrib risk in the population * 5.60 (-4.40, 15.59) Attrib fraction in the population (%) 9.23 (0.49, 17.20) ——————————————————————- Uncorrected chi2 test that OR = 1: chi2(1) = 4.729 Pr&gt;chi2 = 0.030 Fisher exact test that OR = 1: Pr&gt;chi2 = 0.037 Wald confidence limits CI: confidence interval * Outcomes per 100 population units\n\nShow the code\nmod &lt;- glm(mantoux~ cough, family=binomial, data=hhtb)\nparameters::model_parameters(mod, exponentiate=T)",
    "crumbs": [
      "10: Analysis of correlated outcome data"
    ]
  },
  {
    "objectID": "ASME_10.html#parameter-odds-ratio-se-95-ci-z-p",
    "href": "ASME_10.html#parameter-odds-ratio-se-95-ci-z-p",
    "title": "10: Analysis of correlated outcome data",
    "section": "Parameter | Odds Ratio | SE | 95% CI | z | p",
    "text": "Parameter | Odds Ratio | SE | 95% CI | z | p\n(Intercept) | 0.64 | 0.25 | [0.30, 1.36] | -1.16 | 0.247 cough | 1.78 | 0.48 | [1.06, 3.03] | 2.16 | 0.030\n\n\n\n\n\n\nCoding explanation\n\n\n\n\n\nWe can get odds ratios through multiple ways. None of them matched with STATA solution (Why use MH when there is no stratification?!)",
    "crumbs": [
      "10: Analysis of correlated outcome data"
    ]
  }
]